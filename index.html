<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendZ - Login</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600;700;800&family=Poppins:wght@600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Link to the fresh CSS -->
    <link rel="stylesheet" href="style.css?v=10">

    <!-- Supabase SDK (Crucial for Database) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js?v=10"></script>
</head>

<body>
    <div class="wrapper">
        <!-- Visual Brand Side -->
        <div class="visual-side">
            <div class="visual-mesh"></div>
            <div class="visual-content">
                <h1 class="brand-title">SpendZ</h1>
                <p class="brand-tagline">Track Every Rupee, Live Your Best Life üí∏</p>

                <!-- Animated Spending Showcase -->
                <div class="spending-showcase">
                    <div class="showcase-label">üí∞ Daily Spends</div>
                    <div class="spending-scroll">
                        <div class="spend-item">
                            <span class="spend-icon">üçï</span>
                            <span class="spend-name">Pizza Night</span>
                            <span class="spend-amount">‚Çπ450</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">‚òï</span>
                            <span class="spend-name">Coffee</span>
                            <span class="spend-amount">‚Çπ120</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">üé¨</span>
                            <span class="spend-name">Movie</span>
                            <span class="spend-amount">‚Çπ300</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">üìö</span>
                            <span class="spend-name">Books</span>
                            <span class="spend-amount">‚Çπ850</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">üöï</span>
                            <span class="spend-name">Uber</span>
                            <span class="spend-amount">‚Çπ200</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">üéÆ</span>
                            <span class="spend-name">Gaming</span>
                            <span class="spend-amount">‚Çπ1200</span>
                        </div>
                        <!-- Duplicate for seamless loop -->
                        <div class="spend-item">
                            <span class="spend-icon">üçï</span>
                            <span class="spend-name">Pizza Night</span>
                            <span class="spend-amount">‚Çπ450</span>
                        </div>
                        <div class="spend-item">
                            <span class="spend-icon">‚òï</span>
                            <span class="spend-name">Coffee</span>
                            <span class="spend-amount">‚Çπ120</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Form Side -->
        <div class="login-side">
            <div class="login-container">
                <div class="welcome-text">
                    <h2>Welcome Back</h2>
                    <p>Enter your details to access your dashboard.</p>
                </div>


                <!-- Google Sign In Button -->
                <button class="btn btn-google" id="googleBtn" onclick="tryGoogleLogin()">
                    <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google"
                        style="width: 20px; height: 20px;">
                    Continue with Google
                </button>

                <div class="divider">
                    <span>OR CONTINUE WITH EMAIL</span>
                </div>

                <!-- Email Input -->
                <div class="mb-4">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="emailInput" class="form-input" placeholder="name@university.edu"
                        autocomplete="email">
                </div>

                <!-- Error Message for Email -->
                <div id="emailError" class="error-message">
                    <i class="fa-solid fa-circle-exclamation"></i> <span id="emailErrorText">Please enter a valid email
                        address.</span>
                </div>

                <!-- Password Input with Toggle -->
                <div class="mb-4">
                    <label class="form-label">Password</label>
                    <div style="position: relative;">
                        <input type="password" id="passwordInput" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            autocomplete="current-password" style="padding-right: 45px;">
                        <button type="button" onclick="togglePasswordVisibility()"
                            style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-gray); cursor: pointer; padding: 5px;">
                            <i class="fa-solid fa-eye" id="togglePasswordIcon"></i>
                        </button>
                    </div>
                </div>

                <!-- General Error Message -->
                <div id="generalError" class="error-message" style="display: none; margin-bottom: 15px;">
                    <i class="fa-solid fa-circle-exclamation"></i> <span id="generalErrorText"></span>
                </div>

                <!-- Sign In Button -->
                <button class="btn btn-primary" id="signInBtn" onclick="handleDirectLogin()">
                    Sign In
                </button>

                <!-- Sign Up Link -->
                <p style="margin-top: 1.5rem; text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                    Don't have an account? <a href="#" onclick="toggleSignUp()"
                        style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign up for free</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <section class="features-section">
        <div class="section-container">
            <h2 class="section-title">Why Choose SpendZ? üöÄ</h2>
            <p class="section-subtitle">Your ultimate companion for smart money management</p>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Track Every Rupee</h3>
                    <p>Log expenses instantly with our intuitive interface. Know exactly where your money goes.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Smart Budgets</h3>
                    <p>Set monthly budgets and get daily/weekly limits automatically calculated for you.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Visual Insights</h3>
                    <p>Beautiful charts and graphs help you understand your spending patterns at a glance.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Secure & Private</h3>
                    <p>Your data is encrypted and protected. Only you can access your financial information.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Lightning Fast</h3>
                    <p>Add expenses in seconds. No complicated forms or endless clicking required.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Goal Oriented</h3>
                    <p>Set financial goals and track your progress. Stay motivated to save more!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="how-it-works-section">
        <div class="section-container">
            <h2 class="section-title">How It Works üí°</h2>
            <p class="section-subtitle">Get started in 3 simple steps</p>

            <div class="steps-container">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>Sign Up Free</h3>
                    <p>Create your account in seconds using Google or email. No credit card required!</p>
                </div>

                <div class="step-arrow">‚Üí</div>

                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Set Your Budget</h3>
                    <p>Tell us your monthly budget and we'll calculate your daily and weekly limits.</p>
                </div>

                <div class="step-arrow">‚Üí</div>

                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>Track & Save</h3>
                    <p>Log expenses as you spend. Watch your savings grow with smart insights!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <div class="section-container">
            <h2 class="section-title">Frequently Asked Questions ü§î</h2>
            <p class="section-subtitle">Everything you need to know about SpendZ</p>

            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How quickly can I expect to see results?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Most users see improvement in their spending habits within the first 2 weeks of consistent
                        tracking. Our visual insights help you identify spending patterns immediately, allowing you to
                        make informed decisions from day one.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Is the app suitable for beginners?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Absolutely! SpendZ is designed with simplicity in mind. Whether you're tracking expenses for the
                        first time or you're a budgeting pro, our intuitive interface makes money management effortless.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Is my financial data secure?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Yes! We use industry-standard encryption and secure authentication through Supabase. Your data
                        is stored securely and only accessible by you. We never share your information with third
                        parties.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Can I use SpendZ on multiple devices?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Yes! Your data syncs automatically across all your devices. Log in from your phone, tablet, or
                        computer - your expenses are always up to date.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>What categories can I track?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        SpendZ supports multiple categories including Food, Transport, Shopping, Entertainment, Bills,
                        and more. You can easily categorize each expense to understand where your money goes.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Is SpendZ really free?</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Yes! SpendZ is completely free to use with all core features included. No hidden fees, no
                        premium tiers - just powerful expense tracking for everyone.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="section-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3 class="gradient-text" style="font-size: 2rem; margin-bottom: 1rem;">SpendZ</h3>
                    <p>Track Every Rupee, Live Your Best Life üí∏</p>
                    <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
                        Made with ‚ù§Ô∏è for students who want to master their finances
                    </p>
                </div>

                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Product</h4>
                        <a href="#features">Features</a>
                        <a href="#how-it-works">How It Works</a>
                        <a href="#faq">FAQ</a>
                    </div>

                    <div class="footer-column">
                        <h4>Company</h4>
                        <a href="#">About Us</a>
                        <a href="#">Contact</a>
                        <a href="#">Privacy Policy</a>
                    </div>

                    <div class="footer-column">
                        <h4>Connect</h4>
                        <a href="https://twitter.com/spendz_app" target="_blank" rel="noopener"><i
                                class="fa-brands fa-twitter"></i> Twitter</a>
                        <a href="https://instagram.com/me_aarsh" target="_blank" rel="noopener"><i
                                class="fa-brands fa-instagram"></i> Instagram</a>
                        <a href="https://github.com/aarshjain1515-lang" target="_blank" rel="noopener"><i
                                class="fa-brands fa-github"></i> GitHub</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2026 SpendZ. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Check if already logged in
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                window.location.replace('dashboard.html');
            }
        }
        checkSession();

        // === Helper Functions ===

        // Show error message
        function showError(message, isGeneral = false) {
            if (isGeneral) {
                const generalError = document.getElementById('generalError');
                const generalErrorText = document.getElementById('generalErrorText');
                generalErrorText.textContent = message;
                generalError.style.display = 'flex';
            } else {
                const emailError = document.getElementById('emailError');
                const emailErrorText = document.getElementById('emailErrorText');
                emailErrorText.textContent = message;
                emailError.style.display = 'flex';
            }
        }

        // Hide all errors
        function hideErrors() {
            document.getElementById('emailError').style.display = 'none';
            document.getElementById('generalError').style.display = 'none';
            document.getElementById('emailInput').style.borderColor = 'rgba(255,255,255,0.1)';
            document.getElementById('passwordInput').style.borderColor = 'rgba(255,255,255,0.1)';
        }

        // Password visibility toggle
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('passwordInput');
            const toggleIcon = document.getElementById('togglePasswordIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // === Login Functions ===

        // Google Login (Real OAuth)
        async function tryGoogleLogin() {
            const btn = document.getElementById('googleBtn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Connecting...';
            btn.disabled = true;

            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.href.split('#')[0].replace('index.html', '').replace(/\/$/, '') + '/dashboard.html'
                    }
                });

                if (error) throw error;

                // Supabase will handle the redirect
            } catch (err) {
                console.error("Google Login Error:", err);
                alert("Google Login Error: " + err.message);
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }


        async function handleDirectLogin() {
            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            const btn = document.getElementById('signInBtn');

            // Hide previous errors
            hideErrors();

            // Validate Email
            const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (!emailInput.value || !re.test(String(emailInput.value).toLowerCase())) {
                showError('Please enter a valid email address.');
                emailInput.style.borderColor = '#ef4444';
                emailInput.focus();
                return;
            }

            // Validate Password
            if (passwordInput.value.length < 6) {
                showError('Password must be at least 6 characters.', true);
                passwordInput.style.borderColor = '#ef4444';
                passwordInput.focus();
                return;
            }

            // Show loading state
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Authenticating...';
            btn.disabled = true;

            try {
                const email = emailInput.value;
                const password = passwordInput.value;

                console.log('üîê Manual login attempt:', email);

                // Try to login
                let result = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                console.log('Login result:', {
                    hasSession: !!result.data?.session,
                    error: result.error?.message
                });

                // If user doesn't exist, create account
                if (result.error && result.error.message.includes('Invalid login')) {
                    console.log('User not found, creating account...');

                    const signUpResult = await supabase.auth.signUp({
                        email,
                        password,
                        options: { data: { full_name: email.split('@')[0] } }
                    });

                    if (signUpResult.error) throw signUpResult.error;

                    if (signUpResult.data.session) {
                        result = signUpResult;
                    } else {
                        showError('Account created! Please check your email to confirm.', true);
                        btn.innerHTML = btn.innerText.includes('Sign Up') ? 'Sign Up' : 'Sign In';
                        btn.disabled = false;
                        return;
                    }
                }

                if (result.error) throw result.error;

                if (!result.data.session) {
                    throw new Error('Authentication failed. Please try again.');
                }

                console.log('‚úÖ Login successful!');
                localStorage.setItem('spendzLoggedIn', 'true');

                // Success animation
                btn.innerHTML = '<i class="fa-solid fa-check"></i> Success!';
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 500);

            } catch (err) {
                console.error('‚ùå Login failed:', err);
                btn.innerHTML = btn.innerText.includes('Sign Up') ? 'Sign Up' : 'Sign In';
                btn.disabled = false;

                // User-friendly error messages
                let errorMessage = 'Login failed. Please try again.';
                if (err.message.includes('Email not confirmed')) {
                    errorMessage = 'Please confirm your email address first.';
                } else if (err.message.includes('Invalid')) {
                    errorMessage = 'Invalid email or password.';
                } else if (err.message) {
                    errorMessage = err.message;
                }

                showError(errorMessage, true);
            }
        }


        function toggleSignUp() {
            const title = document.querySelector('.welcome-text h2');
            const subtitle = document.querySelector('.welcome-text p');
            const btn = document.querySelector('#signInBtn');
            const link = document.querySelector('p a');

            if (btn.innerText === 'Sign In') {
                title.innerText = 'Create Account';
                subtitle.innerText = 'Join the club & start tracking.';
                btn.innerText = 'Sign Up';
                link.innerText = 'Already have an account? Login';
            } else {
                title.innerText = 'Welcome Back';
                subtitle.innerText = 'Enter your details to access your dashboard.';
                btn.innerText = 'Sign In';
                link.innerText = 'Sign up for free';
            }
        }

        // Clear errors on typing
        document.getElementById('emailInput').addEventListener('input', hideErrors);
        document.getElementById('passwordInput').addEventListener('input', hideErrors);

        // Enter key to submit
        document.getElementById('passwordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleDirectLogin();
            }
        });

        // FAQ Toggle Function
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const answer = faqItem.querySelector('.faq-answer');
            const icon = element.querySelector('i');

            // Close all other FAQs
            document.querySelectorAll('.faq-item').forEach(item => {
                if (item !== faqItem) {
                    item.classList.remove('active');
                    item.querySelector('.faq-answer').style.maxHeight = null;
                    item.querySelector('i').style.transform = 'rotate(0deg)';
                }
            });

            // Toggle current FAQ
            faqItem.classList.toggle('active');
            if (faqItem.classList.contains('active')) {
                answer.style.maxHeight = answer.scrollHeight + 'px';
                icon.style.transform = 'rotate(180deg)';
            } else {
                answer.style.maxHeight = null;
                icon.style.transform = 'rotate(0deg)';
            }
        }
    </script>
</body>

</html>